const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-1.5-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {
          text: "Create kids story on description for 5-8 years kids, Educational story , and all images in Paper cut style: story of boy and Magic School, give me 5 chapters, with detailed images text prompt for each of the chapters and image prompt for story cover book with story name, all in JSON field formatA",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "title": "Leo and the Magic School",\n  "coverImagePrompt": "Paper cut style illustration: A whimsical school building made of colorful paper, with a smiling boy with bright blue eyes and spiky hair peeking from behind a large, magical-looking book.  Stars and sparkles around the school. Title: Leo and the Magic School in a playful font.",\n  "chapters": [\n    {\n      "title": "Leo\'s Ordinary Day",\n      "text": "Leo was a perfectly ordinary boy. He loved playing with his dog, Sparky, a scruffy terrier with one floppy ear. He loved building Lego castles that always seemed to topple over.  He especially loved reading, but even his favorite books couldn\'t compare to the day he discovered the magic school.",\n      "imagePrompt": "Paper cut style illustration: Leo, a boy with brown hair and bright eyes, playing with his floppy-eared dog, Sparky, in a sunny garden filled with paper cut flowers.  Lego bricks scattered around. A slightly worn book lies open nearby."\n    },\n    {\n      "title": "The Whispering Willow",\n      "text": "One afternoon, while exploring near his house, Leo stumbled upon an old, whispering willow tree. Its branches seemed to reach out to him, and as he touched its trunk, a shimmering light enveloped him. When he opened his eyes, he was standing before a magnificent school made of shimmering, colorful paper cut architecture!",\n      "imagePrompt": "Paper cut style illustration: A large willow tree with whispering leaves made of paper.  A glowing, swirling light surrounds Leo as he\'s transported to a magical school. The school is detailed and colorful, made of layered paper cuts, with whimsical towers and windows."\n    },\n    {\n      "title": "Classes in Magic",\n      "text": "Inside the Magic School, Leo met other children who could perform amazing feats of magic!  In one class, they learned to conjure colorful butterflies from thin air. In another, they made paper airplanes soar using only their minds! Leo especially loved the class on making paper flowers bloom instantly.",\n      "imagePrompt": "Paper cut style illustration: Inside a classroom made of layered paper cuts. Children, with diverse features and attire, are levitating paper airplanes, conjuring butterflies, and making paper flowers bloom instantly. The teacher is a friendly owl wearing glasses."\n    },\n    {\n      "title": "The Magical Mystery",\n      "text": "One day, a magical artifact – a shimmering crystal ball – went missing from the school!  Leo and his new friends used their magic skills to solve the mystery. They followed clues left behind, using spells to reveal hidden passages and puzzles made of colorful paper cut designs.",\n      "imagePrompt": "Paper cut style illustration:  A group of children, including Leo, searching for a missing crystal ball in a labyrinthine school corridor made of intricately layered paper cut designs. Hints of magic and glowing elements."\n    },\n    {\n      "title": "Returning Home",\n      "text": "After solving the mystery and returning the crystal ball, Leo had to say goodbye to his magical friends and the amazing school.  But he knew he would never forget his magical adventure. He carried the memory of his time at the magical school in his heart, and the knowledge that even ordinary days could hold extraordinary magic.",\n      "imagePrompt": "Paper cut style illustration: Leo waving goodbye to his friends in front of the magical school. Sparky is waiting for him, wagging his tail.  A small, magical paper cut keepsake is in Leo\'s hand.  The image suggests a bittersweet farewell."\n    }\n  ]\n}\n```\n',
        },
      ],
    },
    {
      role: "user",
      parts: [
        {
          text: "\"Generate a children's educational story for 5-8 year-olds, titled 'Leo and the Magic School'. The story should consist of 5 chapters. Each chapter should have the following:\n\nChapter Title\nChapter Description: A brief narrative description.\nText Prompt for the Story: The main body of text for the chapter.\nImage Prompt: A detailed description of the illustration for the chapter in paper cut style, including any characters, environment, and actions. Additionally, generate a cover image for the story.\nFor each chapter, make sure to include an engaging educational theme, magical elements, and positive, adventurous content that encourages imagination and creativity.\n\nHere's the structure for the chapters:\n\nChapter 1 - Leo's Ordinary Day\n\nDescription: Leo, a regular boy who loves playing with his dog and building Lego castles, stumbles upon a magical school.\nImage Prompt: Paper cut style: Leo playing with his dog in a sunny garden with scattered Lego pieces. A book is lying open nearby.\nChapter 2 - The Whispering Willow\n\nDescription: Leo finds a magical willow tree that transports him to a magical school made of colorful paper cuts.\nImage Prompt: Paper cut style: A magical willow tree with glowing light that transports Leo to a whimsical, paper-cut school.\nChapter 3 - Classes in Magic\n\nDescription: At the magic school, Leo learns magic with other children, like conjuring butterflies and making paper flowers bloom.\nImage Prompt: Paper cut style: Children levitating paper airplanes, conjuring butterflies, and making flowers bloom in a whimsical classroom.\nChapter 4 - The Magical Mystery\n\nDescription: A crystal ball goes missing, and Leo and his friends solve the mystery using their magical skills.\nImage Prompt: Paper cut style: Children searching for the missing crystal ball in a maze of magical corridors.\nChapter 5 - Returning Home\n\nDescription: Leo returns home after solving the mystery, carrying the memory of his magical adventure with him.\nImage Prompt: Paper cut style: Leo waves goodbye to his friends at the magical school while Sparky the dog waits for him.\nAlso, generate a cover image for the story, showing a whimsical school building made of colorful paper, with Leo peeking from behind a magical book, stars, and sparkles around. The title should be in a playful font.\n\nPlease return the full story content, including the chapter titles, descriptions, text prompts, and image prompts in a structured JSON format.\"",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "title": "Leo and the Magic School",\n  "coverImagePrompt": "Paper cut style illustration: A whimsical school building made of colorful paper, with a smiling boy (Leo) with brown hair and bright eyes peeking from behind a large, magical-looking book. Stars and sparkles surround the school.  The title \'Leo and the Magic School\' is written in a playful, handwritten-style font.",\n  "chapters": [\n    {\n      "title": "Leo\'s Ordinary Day",\n      "description": "Leo, a regular boy who loves playing with his dog and building Lego castles, stumbles upon a magical school.",\n      "textPrompt": "Leo loved building towering Lego castles, even though they always seemed to topple over with a satisfying crash! He loved playing fetch with Sparky, his scruffy terrier with one ear perpetually flopped over.  But today felt…ordinary.  Even his favorite book about brave knights and talking dragons couldn\'t quite capture his imagination.  That\'s when he saw it – a flash of shimmering light behind the old oak tree at the edge of his garden.",\n      "imagePrompt": "Paper cut style illustration: Leo, a boy with brown hair and bright eyes, playing fetch with his floppy-eared dog, Sparky, in a sunny garden with scattered Lego pieces. A worn book about knights lies open nearby, partially obscured by a shaft of sunlight.  The oak tree in the background has a slightly unusual, glowing branch."\n    },\n    {\n      "title": "The Whispering Willow",\n      "description": "Leo finds a magical willow tree that transports him to a magical school made of colorful paper cuts.",\n      "textPrompt": "The light led Leo to an ancient willow tree, its branches whispering secrets in the breeze.  As he touched its trunk, a wave of warmth and shimmering light surrounded him.  When it faded, he wasn\'t in his garden anymore! He stood before a breathtaking school, its walls and towers crafted from vibrant, swirling paper cuts – a magical school unlike anything he\'d ever imagined!",\n      "imagePrompt": "Paper cut style illustration:  An ancient willow tree with glowing, swirling leaves.  A beam of light emanates from the tree, transporting Leo into a whimsical, colorful school made entirely of layered paper cuts. The school has towers, turrets, and windows that appear to shimmer and glow."\n    },\n    {\n      "title": "Classes in Magic",\n      "description": "At the magic school, Leo learns magic with other children, like conjuring butterflies and making paper flowers bloom.",\n      "textPrompt": "Inside, Leo met other children who could perform amazing feats of magic! In one class, they learned to conjure colorful butterflies from thin air – learning about metamorphosis and insect life cycles along the way. In another, they made paper airplanes soar using only their minds, exploring aerodynamics and flight. Leo\'s favorite class was \'Floral Flourishes,\' where they made paper flowers bloom instantly, learning about plant growth and the power of imagination.",\n      "imagePrompt": "Paper cut style illustration:  A whimsical classroom inside the paper-cut school. Children with diverse features and clothing are levitating paper airplanes, conjuring butterflies (showing different stages of their life cycle), and making paper flowers bloom instantly.  A kind teacher, perhaps an owl or a friendly wizard, observes with a smile."\n    },\n    {\n      "title": "The Magical Mystery",\n      "description": "A crystal ball goes missing, and Leo and his friends solve the mystery using their magical skills.",\n      "textPrompt": "One day, a sparkling crystal ball, filled with swirling galaxies, went missing!  Leo and his friends used their magical skills to solve the mystery. They followed clues hidden in riddles and puzzles, learning about problem-solving and teamwork as they navigated a maze of magical corridors, each turn revealing a new paper-cut wonder.",\n      "imagePrompt": "Paper cut style illustration: Children, including Leo, searching for the missing crystal ball in a maze of magical corridors within the school. The corridors are filled with intricate paper-cut details. Clues and puzzles are visible, showing numbers, symbols, and small paper cut creatures."\n    },\n    {\n      "title": "Returning Home",\n      "description": "Leo returns home after solving the mystery, carrying the memory of his magical adventure with him.",\n      "textPrompt": "After solving the mystery and returning the crystal ball to its rightful place, it was time for Leo to say goodbye.  He waved to his new friends, promising to write. As he stepped back through the shimmering light of the willow tree, he carried the memory of his magical adventure with him – a reminder that even the most ordinary day can hold extraordinary magic, and that imagination and friendship can conquer any mystery.",\n      "imagePrompt": "Paper cut style illustration: Leo waving goodbye to his friends at the magical school. Sparky the dog waits patiently, tail wagging. Leo holds a small, glowing paper cut memento from the school, perhaps a miniature paper-cut butterfly or flower. The image shows a bittersweet farewell, implying a lasting friendship."\n    }\n  ]\n}\n```\n',
        },
      ],
    },
  ],
});
